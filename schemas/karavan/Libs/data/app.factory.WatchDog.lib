{"enable":true,"script":false,"acl":"*","sandbox":"{}","src":"appDIS.factory('WatchDog', function($http, $interval, $rootScope) {\r\n    \r\n  var _logout = false;\r\n  \r\n  var data = {\r\n    connected:  false,\r\n    session:    false,\r\n    authorized: false\r\n  }\r\n \r\n function broadcast(state) {\r\n   \r\n   var t = {\r\n    connected:  false,\r\n    session:    false,\r\n    authorized: false\r\n   }\r\n   \r\n   if (state === '0:0') {t.connected = true;  t.session = false;        t.authorized = false;}\r\n   if (state === '0:1') {t.connected = false; t.session = data.session; t.authorized = data.authorized;}\r\n   if (state === '1:0') {t.connected = true;  t.session = true;         t.authorized = false;}\r\n   if (state === '1:1') {t.connected = true;  t.session = true;         t.authorized = true;}\r\n   \r\n   \r\n   $rootScope.$broadcast('WatchDog.status', t);\r\n   \r\n   if ((data.connected  !== t.connected) ||\r\n       (data.session    !== t.session) ||\r\n       (data.authorized !== t.authorized) ) {\r\n           \r\n      data = t;\r\n      $rootScope.$broadcast('WatchDog.change', data);\r\n        \r\n   }\r\n }\r\n\r\n function logout() {\r\n   _logout = true;  \r\n }\r\n \r\n function getStatus() {\r\n  return data;  \r\n }\r\n \r\n  function wait() {\r\n    if (!_logout) {\r\n      $http({\r\n        method: 'GET',\r\n        url: 'wait',\r\n        json: true,\r\n        params: {}\r\n      }).success(function(data) {\r\n        broadcast(data);\r\n      }).error(function() {\r\n        broadcast('0:1');\r\n      });\r\n    }\r\n  }\r\n \r\n wait();\r\n $interval(wait, 10000);\r\n  \r\n return {\r\n   status: getStatus,\r\n   logout: logout\r\n };\r\n \r\n});  "}