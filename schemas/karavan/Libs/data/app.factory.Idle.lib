{"enable":true,"script":false,"acl":"*","sandbox":"{}","src":"appDIS.factory('Idle', function($interval, $rootScope) {\r\n \r\n /**\r\n  * $broadcast 'Idle'  isIdle {Boolean}\r\n  */\r\n \r\n var timer;\r\n var idleTime = 300; /* секунды */\r\n var counter  = -idleTime;\r\n var isIdle   = false;\r\n \r\n /* Счетчик времени простоя */\r\n $interval(function(){\r\n   //console.log('Idle', counter);\r\n   counter++;\r\n }, 1000);\r\n \r\n /* Назначить элемент DOM для слежения за активностью */\r\n function look(element) {\r\n    var el = angular.element(element);\r\n    if (el) {\r\n      el.bind('click mousemove keydown DOMMouseScroll mousewheel mousedown touchstart touchmove scroll', function (e) {action(e);});\r\n    }\r\n    action();\r\n }\r\n \r\n /* Установить активность пользователя */\r\n function action(e){\r\n    //console.log('Idle action', e);\r\n    $interval.cancel(timer);\r\n    timer   = $interval(idle, idleTime*1000, 1);\r\n    counter = -idleTime;\r\n    if (isIdle) {\r\n        isIdle = false;\r\n        $rootScope.$broadcast('Idle', isIdle);\r\n        //console.log('Idle false');\r\n    }\r\n }\r\n \r\n /* Получить время простоя в секундах */\r\n function status(){\r\n    return counter;\r\n }\r\n \r\n /* Функция уведомлени о простое */\r\n function idle(){\r\n    $interval.cancel(timer);\r\n    if (!isIdle) {\r\n        isIdle  = true;\r\n        $rootScope.$broadcast('Idle', isIdle);\r\n        //console.log('Idle true');\r\n    }\r\n }\r\n \r\n return {\r\n   status: status,\r\n   look:   look,\r\n   action: action,\r\n   idle:   idle\r\n };\r\n \r\n});  "}